!function(a){function b(a){return"[object Array]"===Object.prototype.toString.call(a)}function c(c){function e(a){switch(a=a||window.event,a.which){case 32:d.togglePlayPause();break;case 37:d.playRange.value=d.round(parseFloat(d.playRange.value)-1),d.updateChart(d.playRange.value);break;case 39:d.playRange.value=d.round(parseFloat(d.playRange.value)+1),d.updateChart(d.playRange.value);break;default:return}a.preventDefault()}var d=this;this.chart=c,this.paused=!0,this.options=a.merge(this.defaultOptions,this.chart.options.motion),this.dataSeries=[],this.dataLength=0,d.options.series=a.splat(d.options.series),Highcharts.each(this.chart.series,function(a,b){if(d.options.series.indexOf(b)>=0){d.dataSeries[b]=a;for(var c=0;c<a.data.length;c++)a.data[c].sequence&&(d.dataLength=Math.max(d.dataLength,a.data[c].sequence.length))}}),this.playControls=a.createElement("div",{id:"play-controls"},null,this.chart.renderTo,null),this.playPauseBtn=a.createElement("button",{id:"play-pause-button",title:"play"},null,this.playControls,null),this.playPauseBtn.className=this.options.playIcon,this.playRange=a.createElement("input",{id:"play-range",type:"range",value:a.pick(this.options.startIndex,this.dataLength-1),min:0,max:this.dataLength-1,step:this.options.magnet.step},null,this.playControls,null),this.playOutput=a.createElement("label",{id:"play-output",name:this.options.axisLabel},null,this.playControls,null),b(this.options.labels)?this.playOutput.innerHTML=this.options.labels[this.dataLength-1]||"":this.playOutput.innerHTML=this.dataLength-1,Highcharts.addEvent(this.playPauseBtn,"click",function(){d.togglePlayPause()}),Highcharts.addEvent(this.playRange,"mouseup",function(){d.attractToStep()}),Highcharts.addEvent(this.playRange,"input",function(){d.updateChart(this.value)}),Highcharts.addEvent(this.playControls,"click",function(){d.playRange.focus()}),Highcharts.addEvent(this.playPauseBtn,"keydown",e),Highcharts.addEvent(this.playRange,"keydown",e),this.inputValue=parseFloat(this.playRange.value),this.updateChart(this.inputValue),this.autoPlay&&this.play()}c.prototype.defaultOptions={enabled:!0,axisLabel:"year",autoPlay:!1,loop:!1,series:0,updateInterval:10,magnet:{round:"round",step:.01},playIcon:"fa fa-play",pauseIcon:"fa fa-pause"},c.prototype.togglePlayPause=function(){this[this.paused?"play":"pause"]()},c.prototype.play=function(){var a=this;this.paused&&parseFloat(this.playRange.value)===parseFloat(this.playRange.max)&&this.reset(),this.changeButtonType("pause"),this.paused=!1,this.timer=setInterval(function(){a.playUpdate()},this.options.updateInterval)},c.prototype.pause=function(){this.changeButtonType("play"),this.paused=!0,window.clearInterval(this.timer),this.attractToStep()},c.prototype.reset=function(){this.playRange.value=this.playRange.min,this.updateChart(this.playRange.value)},c.prototype.changeButtonType=function(a){this.playPauseBtn.title=a,this.playPauseBtn.className=a+" ","play"==a?this.playPauseBtn.className+=this.options.playIcon:"pause"==a&&(this.playPauseBtn.className+=this.options.pauseIcon)},c.prototype.playUpdate=function(){this.paused||(this.inputValue=parseFloat(this.playRange.value),this.playRange.value=this.inputValue+this.options.magnet.step,this.attractToStep(),this.updateChart(this.playRange.value),this.playRange.value>=parseFloat(this.playRange.max)&&(this.options.loop?this.reset():this.pause()))},c.prototype.updateChart=function(a){var b,c,d,f,e=this.round(a);if(this.currentAxisValue!==e){this.currentAxisValue=e,this.chart.options.motion.startIndex=e;for(b in this.dataSeries)if(this.dataSeries.hasOwnProperty(b))for(c=this.dataSeries[b],f=0;f<c.data.length;f++){d=c.data[f];try{d.sequence&&d.update(d.sequence[e],!1,!1)}catch(a){console.error("Error:",a," \nat point:",d," \nwith new value:",d.sequence[e])}}this.chart.redraw(),this.attractToStep()}},c.prototype.attractToStep=function(){b(this.options.labels)?this.playOutput.innerHTML=this.options.labels[this.round(this.playRange.value)]||"":this.playOutput.innerHTML=this.round(this.playRange.value)},c.prototype.round=function(a){return Math[this.options.magnet.round](a)},a.Chart.prototype.callbacks.push(function(a){a.options.motion&&a.options.motion.enabled&&(a.motion=new c(a))}),a.Motion=c}(Highcharts);